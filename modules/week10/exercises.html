<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>🤯 Exercises | MAD9137</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="iOS App Development">
    
    <link rel="preload" href="/w2025/assets/css/0.styles.b90e271b.css" as="style"><link rel="preload" href="/w2025/assets/js/app.89661042.js" as="script"><link rel="preload" href="/w2025/assets/js/2.19621ee8.js" as="script"><link rel="preload" href="/w2025/assets/js/1.884addea.js" as="script"><link rel="preload" href="/w2025/assets/js/37.d8fe8075.js" as="script"><link rel="prefetch" href="/w2025/assets/js/10.14d5c403.js"><link rel="prefetch" href="/w2025/assets/js/11.03916557.js"><link rel="prefetch" href="/w2025/assets/js/12.b43e8f2c.js"><link rel="prefetch" href="/w2025/assets/js/13.6649c7b8.js"><link rel="prefetch" href="/w2025/assets/js/14.88d905c8.js"><link rel="prefetch" href="/w2025/assets/js/15.7e17213b.js"><link rel="prefetch" href="/w2025/assets/js/16.e53c757f.js"><link rel="prefetch" href="/w2025/assets/js/17.3cc02802.js"><link rel="prefetch" href="/w2025/assets/js/18.81d0be88.js"><link rel="prefetch" href="/w2025/assets/js/19.ca440789.js"><link rel="prefetch" href="/w2025/assets/js/20.5a6b51cb.js"><link rel="prefetch" href="/w2025/assets/js/21.fdfc60c0.js"><link rel="prefetch" href="/w2025/assets/js/22.d45beffc.js"><link rel="prefetch" href="/w2025/assets/js/23.748b914a.js"><link rel="prefetch" href="/w2025/assets/js/24.562b255d.js"><link rel="prefetch" href="/w2025/assets/js/25.07dd87ce.js"><link rel="prefetch" href="/w2025/assets/js/26.a99defbe.js"><link rel="prefetch" href="/w2025/assets/js/27.57083705.js"><link rel="prefetch" href="/w2025/assets/js/28.e39dc93e.js"><link rel="prefetch" href="/w2025/assets/js/29.a5b2f49c.js"><link rel="prefetch" href="/w2025/assets/js/3.f5bb6a7e.js"><link rel="prefetch" href="/w2025/assets/js/30.de0a6d63.js"><link rel="prefetch" href="/w2025/assets/js/31.bfc16249.js"><link rel="prefetch" href="/w2025/assets/js/32.d9c060a0.js"><link rel="prefetch" href="/w2025/assets/js/33.a2d064ce.js"><link rel="prefetch" href="/w2025/assets/js/34.b8161021.js"><link rel="prefetch" href="/w2025/assets/js/35.a40d4351.js"><link rel="prefetch" href="/w2025/assets/js/36.9403338f.js"><link rel="prefetch" href="/w2025/assets/js/38.9e90ebe0.js"><link rel="prefetch" href="/w2025/assets/js/39.25172786.js"><link rel="prefetch" href="/w2025/assets/js/4.86681f1d.js"><link rel="prefetch" href="/w2025/assets/js/40.6681711c.js"><link rel="prefetch" href="/w2025/assets/js/41.f4e3d0a0.js"><link rel="prefetch" href="/w2025/assets/js/42.8c656f3d.js"><link rel="prefetch" href="/w2025/assets/js/43.31dda87d.js"><link rel="prefetch" href="/w2025/assets/js/44.24c69334.js"><link rel="prefetch" href="/w2025/assets/js/45.5e16c653.js"><link rel="prefetch" href="/w2025/assets/js/46.044a1533.js"><link rel="prefetch" href="/w2025/assets/js/47.1830e7db.js"><link rel="prefetch" href="/w2025/assets/js/48.9be09712.js"><link rel="prefetch" href="/w2025/assets/js/49.4451aa8c.js"><link rel="prefetch" href="/w2025/assets/js/5.adc9a5d1.js"><link rel="prefetch" href="/w2025/assets/js/50.81e47b6b.js"><link rel="prefetch" href="/w2025/assets/js/51.3b191912.js"><link rel="prefetch" href="/w2025/assets/js/52.479b82bb.js"><link rel="prefetch" href="/w2025/assets/js/53.729d7b6c.js"><link rel="prefetch" href="/w2025/assets/js/54.4a8647ab.js"><link rel="prefetch" href="/w2025/assets/js/55.055c6480.js"><link rel="prefetch" href="/w2025/assets/js/56.1812c123.js"><link rel="prefetch" href="/w2025/assets/js/57.b2aeb55f.js"><link rel="prefetch" href="/w2025/assets/js/58.9f74ca68.js"><link rel="prefetch" href="/w2025/assets/js/59.973fa6ff.js"><link rel="prefetch" href="/w2025/assets/js/6.6eb1a791.js"><link rel="prefetch" href="/w2025/assets/js/60.dbaf804d.js"><link rel="prefetch" href="/w2025/assets/js/61.bf2bcd99.js"><link rel="prefetch" href="/w2025/assets/js/62.c8975600.js"><link rel="prefetch" href="/w2025/assets/js/63.1dc95d7a.js"><link rel="prefetch" href="/w2025/assets/js/64.b1f5fc8e.js"><link rel="prefetch" href="/w2025/assets/js/65.37d03985.js"><link rel="prefetch" href="/w2025/assets/js/66.cf8375ea.js"><link rel="prefetch" href="/w2025/assets/js/67.f92bb3ff.js"><link rel="prefetch" href="/w2025/assets/js/68.779861c3.js"><link rel="prefetch" href="/w2025/assets/js/69.cc00bcbf.js"><link rel="prefetch" href="/w2025/assets/js/7.b2a63ac7.js"><link rel="prefetch" href="/w2025/assets/js/70.362eb054.js"><link rel="prefetch" href="/w2025/assets/js/71.aad5c756.js"><link rel="prefetch" href="/w2025/assets/js/72.1a4b2363.js"><link rel="prefetch" href="/w2025/assets/js/73.aa3beb5c.js"><link rel="prefetch" href="/w2025/assets/js/74.25ee9996.js"><link rel="prefetch" href="/w2025/assets/js/75.3bca0c1f.js"><link rel="prefetch" href="/w2025/assets/js/76.ed9eeaee.js"><link rel="prefetch" href="/w2025/assets/js/77.2d013309.js"><link rel="prefetch" href="/w2025/assets/js/78.aba051f0.js"><link rel="prefetch" href="/w2025/assets/js/79.bfa621d0.js"><link rel="prefetch" href="/w2025/assets/js/80.5ea75b6b.js"><link rel="prefetch" href="/w2025/assets/js/81.c963a39c.js"><link rel="prefetch" href="/w2025/assets/js/82.cb43b67f.js"><link rel="prefetch" href="/w2025/assets/js/83.d9e9c653.js"><link rel="prefetch" href="/w2025/assets/js/84.827a886f.js"><link rel="prefetch" href="/w2025/assets/js/85.2c52868b.js"><link rel="prefetch" href="/w2025/assets/js/86.ac7150af.js"><link rel="prefetch" href="/w2025/assets/js/87.b3adcd6f.js"><link rel="prefetch" href="/w2025/assets/js/vendors~docsearch.02634ae8.js">
    <link rel="stylesheet" href="/w2025/assets/css/0.styles.b90e271b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/w2025/" class="home-link router-link-active"><!----> <span class="site-name">MAD9137</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/w2025/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/w2025/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2025/modules/week1/lecture1.html" class="nav-link">
  Modules
</a></div><div class="nav-item"><a href="/w2025/assessment/" class="nav-link">
  Assessments
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/w2025/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/w2025/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2025/modules/week1/lecture1.html" class="nav-link">
  Modules
</a></div><div class="nav-item"><a href="/w2025/assessment/" class="nav-link">
  Assessments
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week1/" class="sidebar-heading clickable"><span>Week 1</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week2/" class="sidebar-heading clickable"><span>Week 2</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week3/" class="sidebar-heading clickable"><span>Week 3</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week4/" class="sidebar-heading clickable"><span>Week 4</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week5/" class="sidebar-heading clickable"><span>Week 5</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week6/" class="sidebar-heading clickable"><span>Week 6</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week7/" class="sidebar-heading clickable"><span>Week 7</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/w2025/modules/week8/" class="sidebar-link">Week 8</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week9/" class="sidebar-heading clickable"><span>Week 9</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week10/" class="sidebar-heading clickable router-link-active open"><span>Week 10</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/w2025/modules/week10/lecture1.html" class="sidebar-link">Swift async/await 🚀</a></li><li><a href="/w2025/modules/week10/lecture2.html" class="sidebar-link">REST APIs 🚀</a></li><li><a href="/w2025/modules/week10/exercises.html" aria-current="page" class="active sidebar-link">🤯 Exercises</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2025/modules/week10/exercises.html#exercise-1-basic-asynchronous-function" class="sidebar-link">Exercise 1: Basic Asynchronous Function</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/week10/exercises.html#exercise-2-calling-another-async-function" class="sidebar-link">Exercise 2: Calling Another Async Function</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/week10/exercises.html#exercise-3-parallel-execution-with-async-let" class="sidebar-link">Exercise 3: Parallel Execution with async let</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/week10/exercises.html#exercise-4-handling-errors-in-async-functions" class="sidebar-link">Exercise 4: Handling Errors in Async Functions</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/week10/exercises.html#exercise-5-combining-results-from-multiple-async-functions" class="sidebar-link">Exercise 5: Combining Results from Multiple Async Functions</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/week10/exercises.html#exercise-6" class="sidebar-link">Exercise 6</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/week10/exercises.html#exercise-7" class="sidebar-link">Exercise 7</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/week10/exercises.html#exercise-8" class="sidebar-link">Exercise 8</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/week10/exercises.html#exercise-9" class="sidebar-link">Exercise 9</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/week10/exercises.html#exercise-10" class="sidebar-link">Exercise 10</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week11/" class="sidebar-heading clickable"><span>Week 11</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week12/" class="sidebar-heading clickable"><span>Week 12</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week13/" class="sidebar-heading clickable"><span>Week 13</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week14/" class="sidebar-heading clickable"><span>Week 14</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/w2025/modules/week15/" class="sidebar-link">Week 15</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="🤯-exercises"><a href="#🤯-exercises" class="header-anchor">#</a> 🤯 Exercises</h1> <h2 id="exercise-1-basic-asynchronous-function"><a href="#exercise-1-basic-asynchronous-function" class="header-anchor">#</a> Exercise 1: Basic Asynchronous Function</h2> <p><strong>What is the purpose of the <code>async</code> keyword in the following function? How would you call this function?</strong></p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token class-name">Task</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1_000_000_000</span><span class="token punctuation">)</span> <span class="token comment">// Simulates a network delay</span>
    <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">&quot;Fetched Data&quot;</span></span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><details class="custom-block details"><summary>Solution</summary> <p>The <code>async</code> keyword indicates that the <code>fetchData</code> function is asynchronous, allowing it to be paused and resumed. To call this function, you must be within another asynchronous function or a <code>Task</code>, like this:</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token class-name">Task</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></details> <h2 id="exercise-2-calling-another-async-function"><a href="#exercise-2-calling-another-async-function" class="header-anchor">#</a> Exercise 2: Calling Another Async Function</h2> <p><strong>How would you implement a function that calls <code>fetchData</code> and returns a formatted string?</strong></p> <details class="custom-block details"><summary>Solution</summary> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">loadUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">&quot;User data loaded: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">data</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The <code>loadUserData</code> function is declared with the <code>async</code> keyword and uses <code>await</code> to call <code>fetchData</code>. This allows it to pause until <code>fetchData</code> returns its result, enabling the construction of a formatted string.</p></details> <h2 id="exercise-3-parallel-execution-with-async-let"><a href="#exercise-3-parallel-execution-with-async-let" class="header-anchor">#</a> Exercise 3: Parallel Execution with async let</h2> <p><strong>Rewrite the following sequential calls using <code>async let</code> to fetch user data for two users in parallel:</strong></p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token class-name">Task</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> user1Data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchUserData</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;user123&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> user2Data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchUserData</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;user456&quot;</span></span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;User 1: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">user1Data</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, User 2: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">user2Data</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><details class="custom-block details"><summary>Solution</summary> <p>You can use <code>async let</code> to run the fetch operations concurrently like this:</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token class-name">Task</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token keyword">let</span> user1Data <span class="token operator">=</span> <span class="token function">fetchUserData</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;user123&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">async</span> <span class="token keyword">let</span> user2Data <span class="token operator">=</span> <span class="token function">fetchUserData</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;user456&quot;</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span>user1Data<span class="token punctuation">,</span> user2Data<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;User 1: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">results<span class="token punctuation">.</span><span class="token number">0</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, User 2: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">results<span class="token punctuation">.</span><span class="token number">1</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></details> <h2 id="exercise-4-handling-errors-in-async-functions"><a href="#exercise-4-handling-errors-in-async-functions" class="header-anchor">#</a> Exercise 4: Handling Errors in Async Functions</h2> <p><strong>How can you modify the following function to throw an error if data fetching fails? Implement error handling when calling this function.</strong></p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">fetchDataWithError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token class-name">Task</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1_000_000_000</span><span class="token punctuation">)</span> <span class="token comment">// Simulate a delay</span>
    <span class="token keyword">throw</span> <span class="token class-name">DataError</span><span class="token punctuation">.</span>networkError <span class="token comment">// This should throw a network error</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><details class="custom-block details"><summary>Solution</summary> <p>You can call <code>fetchDataWithError</code> in a <code>Task</code> with error handling like this:</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token class-name">Task</span> <span class="token punctuation">{</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token keyword">await</span> <span class="token function">fetchDataWithError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Failed to fetch data: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></details> <h2 id="exercise-5-combining-results-from-multiple-async-functions"><a href="#exercise-5-combining-results-from-multiple-async-functions" class="header-anchor">#</a> Exercise 5: Combining Results from Multiple Async Functions</h2> <p><strong>Write a function that fetches data twice asynchronously, combines the results, and prints them. Explain how you handle the asynchronous calls.</strong></p> <details class="custom-block details"><summary>Solution</summary> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">combineFetchedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token keyword">let</span> data1 <span class="token operator">=</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">async</span> <span class="token keyword">let</span> data2 <span class="token operator">=</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">let</span> combinedData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">data1</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> &amp; </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">data2</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Combined Data: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">combinedData</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>The <code>combineFetchedData</code> function uses <code>async let</code> to initiate two <code>fetchData</code> calls concurrently. It then awaits both results to combine them into a single string, demonstrating how to handle multiple asynchronous calls effectively without blocking execution.</p></details> <h2 id="exercise-6"><a href="#exercise-6" class="header-anchor">#</a> Exercise 6</h2> <p>Create a Swift struct called <code>CityWeather</code> that represents weather data returned from an API. The struct should include properties for the city's name (a <code>String</code>) and its temperature (a <code>Double</code>). Use the <code>Codable</code> protocol to make it JSON-decodable.</p> <details class="custom-block details"><summary>Solution</summary> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token class-name">Foundation</span>

<span class="token keyword">struct</span> <span class="token class-name">CityWeather</span><span class="token punctuation">:</span> <span class="token class-name">Codable</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">let</span> temperature<span class="token punctuation">:</span> <span class="token class-name">Double</span>
    
    <span class="token keyword">enum</span> <span class="token class-name">CodingKeys</span><span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">CodingKey</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> name
        <span class="token keyword">case</span> temperature <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;temp&quot;</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>This <code>CityWeather</code> struct represents weather data for a city, specifically the city’s name and temperature. Here’s a breakdown of its key components:</p> <h3 id="struct-definition"><a href="#struct-definition" class="header-anchor">#</a> Struct Definition</h3> <ul><li><code>CityWeather</code> conforms to <code>Codable</code>, which combines <code>Encodable</code> and <code>Decodable</code> protocols. This enables easy conversion to and from JSON or other encoded formats.</li> <li>By conforming to <code>Codable</code>, you can decode JSON data into a <code>CityWeather</code> instance or encode <code>CityWeather</code> to JSON.</li></ul> <h3 id="properties"><a href="#properties" class="header-anchor">#</a> Properties</h3> <ul><li><code>name</code>: a <code>String</code> representing the name of the city.</li> <li><code>temperature</code>: a <code>Double</code> representing the temperature in that city.</li></ul> <h3 id="codingkeys-enum"><a href="#codingkeys-enum" class="header-anchor">#</a> CodingKeys Enum</h3> <ul><li>The <code>CodingKeys</code> enum customizes the mapping between the JSON keys and the struct’s properties. In JSON data, fields are often formatted differently from Swift property names.</li> <li><code>name</code> is mapped directly, meaning the JSON data for this property should also use &quot;name.&quot;</li> <li><code>temperature</code> is mapped to <code>&quot;temp&quot;</code>, which indicates that when decoding from JSON, the JSON field <code>&quot;temp&quot;</code> will map to the <code>temperature</code> property in <code>CityWeather</code>. This is useful when the JSON uses abbreviations or different conventions that you want to adapt to Swift's property names.</li></ul> <h3 id="usage-example"><a href="#usage-example" class="header-anchor">#</a> Usage Example</h3> <p>If the JSON data for a city’s weather looks like this:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Ottawa&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;temp&quot;</span><span class="token operator">:</span> <span class="token number">22.5</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>You could decode it into a <code>CityWeather</code> instance, and it would look like:</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> jsonData <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;&quot;&quot;
{
    &quot;name&quot;: &quot;Ottawa&quot;,
    &quot;temp&quot;: 22.5
}
&quot;&quot;&quot;</span></span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span> <span class="token punctuation">.</span>utf8<span class="token punctuation">)</span><span class="token operator">!</span>

<span class="token keyword">let</span> decoder <span class="token operator">=</span> <span class="token class-name">JSONDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> cityWeather <span class="token operator">=</span> <span class="token keyword">try</span> decoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">CityWeather</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> jsonData<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>cityWeather<span class="token punctuation">.</span>name<span class="token punctuation">)</span>       <span class="token comment">// Output: Ottawa</span>
    <span class="token function">print</span><span class="token punctuation">(</span>cityWeather<span class="token punctuation">.</span>temperature<span class="token punctuation">)</span> <span class="token comment">// Output: 22.5</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Decoding error: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>This structure and code provide a clean and flexible way to handle JSON data for city weather information, especially if the JSON keys differ from Swift naming conventions.</p></details> <hr> <h2 id="exercise-7"><a href="#exercise-7" class="header-anchor">#</a> Exercise 7</h2> <p>Write a function called <code>createWeatherURL</code> that accepts a city name as a parameter and returns an optional <code>URL</code>. The function should construct a URL using the base URL for a weather API and include the city name as a query parameter. Assume the base URL is <code>https://api.weatherapi.com/v1/current.json</code> and an API key is provided.</p> <details class="custom-block details"><summary>Solution</summary> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token class-name">Foundation</span>

<span class="token keyword">func</span> <span class="token function-definition function">createWeatherURL</span><span class="token punctuation">(</span><span class="token keyword">for</span> city<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token constant">URL</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> apiKey <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;your_api_key&quot;</span></span>
    <span class="token keyword">let</span> baseURL <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;https://api.weatherapi.com/v1/current.json&quot;</span></span>
    <span class="token keyword">var</span> components <span class="token operator">=</span> <span class="token class-name">URLComponents</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> baseURL<span class="token punctuation">)</span>
    components<span class="token operator">?</span><span class="token punctuation">.</span>queryItems <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token class-name">URLQueryItem</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;key&quot;</span></span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> apiKey<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">URLQueryItem</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;q&quot;</span></span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> city<span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    <span class="token keyword">return</span> components<span class="token operator">?</span><span class="token punctuation">.</span>url
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>This code defines a Swift function, <code>createWeatherURL</code>, which generates a URL for retrieving current weather data for a specified city from the WeatherAPI. Here’s a detailed breakdown of each part:</p> <h3 id="code-breakdown"><a href="#code-breakdown" class="header-anchor">#</a> Code Breakdown</h3> <p><strong>Function Declaration</strong>:</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">createWeatherURL</span><span class="token punctuation">(</span><span class="token keyword">for</span> city<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token constant">URL</span><span class="token operator">?</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>The function <code>createWeatherURL</code> takes a single parameter, <code>city</code> of type <code>String</code>, which specifies the city for which weather data is to be fetched.</li> <li>The function returns an optional <code>URL</code> (<code>URL?</code>), meaning it may return <code>nil</code> if the URL cannot be constructed.</li></ul> <p><strong>API Key and Base URL</strong>:</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> apiKey <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;your_api_key&quot;</span></span>
<span class="token keyword">let</span> baseURL <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;https://api.weatherapi.com/v1/current.json&quot;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>apiKey</code> is a placeholder for the API key you get when registering with WeatherAPI. To make actual API requests, replace <code>&quot;your_api_key&quot;</code> with your own API key.</li> <li><code>baseURL</code> is the base endpoint for WeatherAPI’s &quot;current weather&quot; service.</li></ul> <p><strong>URL Components</strong>:</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">var</span> components <span class="token operator">=</span> <span class="token class-name">URLComponents</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> baseURL<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>URLComponents</code> is used to construct a URL by safely appending query parameters. Here, it initializes with <code>baseURL</code>.</li> <li>If <code>baseURL</code> is valid, <code>components</code> will not be <code>nil</code>.</li></ul> <p><strong>Setting Query Parameters</strong>:</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code>components<span class="token operator">?</span><span class="token punctuation">.</span>queryItems <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token class-name">URLQueryItem</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;key&quot;</span></span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> apiKey<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">URLQueryItem</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;q&quot;</span></span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> city<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>queryItems</code> is an array of <code>URLQueryItem</code> objects, which represent the query parameters in the URL.</li> <li>It adds two parameters:
<ul><li><code>key</code>: Your API key (<code>apiKey</code>).</li> <li><code>q</code>: The city for which you want weather data (<code>city</code> parameter).</li></ul></li></ul> <p><strong>Returning the Final URL</strong>:</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">return</span> components<span class="token operator">?</span><span class="token punctuation">.</span>url
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>components?.url</code> constructs the final URL with the base URL and query parameters.</li> <li>If the URL can’t be constructed (e.g., if <code>baseURL</code> is malformed), this will return <code>nil</code>.</li></ul> <h3 id="example-usage"><a href="#example-usage" class="header-anchor">#</a> Example Usage</h3> <p>If you call <code>createWeatherURL(for: &quot;Ottawa&quot;)</code> with <code>apiKey</code> set correctly, the resulting URL might look like this:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>https<span class="token operator">:</span><span class="token comment">//api.weatherapi.com/v1/current.json?key=your_api_key&amp;q=Ottawa</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="summary"><a href="#summary" class="header-anchor">#</a> Summary</h3> <p>The function <strong>dynamically creates a URL</strong> for fetching current weather data for any specified city by appending an API key and city name as query parameters to a base URL. The use of <code>URLComponents</code> ensures that the URL is properly constructed and encoded.</p></details> <h2 id="exercise-8"><a href="#exercise-8" class="header-anchor">#</a> Exercise 8</h2> <p>Implement a function <code>fetchWeatherData(for:completion:)</code> in a <code>WeatherService</code> class that uses URLSession to make a GET request to a weather API. This function should use a callback to return either the parsed <code>CityWeather</code> data or an error.</p> <details class="custom-block details"><summary>Solution</summary> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token class-name">Foundation</span>

<span class="token keyword">class</span> <span class="token class-name">WeatherService</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function-definition function">fetchWeatherData</span><span class="token punctuation">(</span><span class="token keyword">for</span> city<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> completion<span class="token punctuation">:</span> <span class="token attribute atrule">@escaping</span> <span class="token punctuation">(</span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">CityWeather</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">createWeatherURL</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> city<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">completion</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span><span class="token class-name">NSError</span><span class="token punctuation">(</span>domain<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span><span class="token punctuation">,</span> code<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">NSLocalizedDescriptionKey</span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Invalid URL&quot;</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">let</span> task <span class="token operator">=</span> <span class="token class-name">URLSession</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">dataTask</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> <span class="token omit keyword">_</span><span class="token punctuation">,</span> error <span class="token keyword">in</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> error <span class="token operator">=</span> error <span class="token punctuation">{</span>
                <span class="token function">completion</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span>
            
            <span class="token keyword">guard</span> <span class="token keyword">let</span> data <span class="token operator">=</span> data <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">completion</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span><span class="token class-name">NSError</span><span class="token punctuation">(</span>domain<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span><span class="token punctuation">,</span> code<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">NSLocalizedDescriptionKey</span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;No data received&quot;</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span>
            
            <span class="token keyword">do</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> weatherData <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">JSONDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">CityWeather</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> data<span class="token punctuation">)</span>
                <span class="token function">completion</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>weatherData<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
                <span class="token function">completion</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        task<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>This code defines a <code>WeatherService</code> class that fetches weather data for a specified city by making a network request and decoding the JSON response. Here's a breakdown of the code:</p> <h3 id="class-weatherservice"><a href="#class-weatherservice" class="header-anchor">#</a> Class: <code>WeatherService</code></h3> <p>The <code>WeatherService</code> class contains a method, <code>fetchWeatherData</code>, which retrieves weather data for a given city. It uses an asynchronous <code>URLSession</code> data task to handle the network request.</p> <h3 id="method-fetchweatherdata-for-completion"><a href="#method-fetchweatherdata-for-completion" class="header-anchor">#</a> Method: <code>fetchWeatherData(for:completion:)</code></h3> <ul><li><strong>Parameters</strong>:
<ul><li><code>city</code>: A <code>String</code> representing the city name for which to fetch the weather data.</li> <li><code>completion</code>: A closure that returns a <code>Result</code> with either a <code>CityWeather</code> instance (success) or an <code>Error</code> (failure).</li></ul></li></ul> <h4 id="_1-url-creation"><a href="#_1-url-creation" class="header-anchor">#</a> 1. <strong>URL Creation</strong></h4> <ul><li>The method starts by calling <code>createWeatherURL(for:)</code> to construct a valid URL for the weather API endpoint. If the URL is invalid (i.e., <code>nil</code>), it returns early by invoking the <code>completion</code> closure with an error indicating &quot;Invalid URL.&quot;</li></ul> <h4 id="_2-data-task-with-urlsession"><a href="#_2-data-task-with-urlsession" class="header-anchor">#</a> 2. <strong>Data Task with URLSession</strong></h4> <ul><li>If the URL is valid, it initiates a network request using <code>URLSession.shared.dataTask(with:)</code>.</li> <li>In the completion handler:
<ul><li>If there’s an error with the request (e.g., network issues), the method calls the <code>completion</code> closure with that error and exits.</li> <li>If no data is received, the method returns early with an error indicating &quot;No data received.&quot;</li></ul></li></ul> <h4 id="_3-json-decoding"><a href="#_3-json-decoding" class="header-anchor">#</a> 3. <strong>JSON Decoding</strong></h4> <ul><li>If data is received successfully, the code attempts to decode the JSON response into a <code>CityWeather</code> object using <code>JSONDecoder</code>.</li> <li>If decoding succeeds, the <code>completion</code> closure is called with the <code>CityWeather</code> object (success case).</li> <li>If decoding fails, it returns the error to the <code>completion</code> closure (failure case).</li></ul> <h3 id="key-concepts"><a href="#key-concepts" class="header-anchor">#</a> Key Concepts</h3> <ul><li><strong>Error Handling</strong>: This method uses Swift's <code>Result</code> type to handle both success and failure cases, making it clear whether the operation succeeded or failed and providing an error if needed.</li> <li><strong>Asynchronous Programming</strong>: <code>URLSession</code> runs the network request asynchronously, so <code>completion</code> is an escaping closure that can be called once the data has been fetched and processed.</li></ul> <p>To use this method, you'd pass in a city name and a closure to handle the result, checking for either a successful <code>CityWeather</code> response or handling any errors that occur.</p></details> <h2 id="exercise-9"><a href="#exercise-9" class="header-anchor">#</a> Exercise 9</h2> <p>Convert the callback-based <code>fetchWeatherData(for:completion:)</code> function in <code>WeatherService</code> to an async/await function called <code>fetchWeatherData(for:)</code>. This function should throw errors instead of returning them in a callback.</p> <details class="custom-block details"><summary>Solution</summary> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token class-name">Foundation</span>

<span class="token keyword">class</span> <span class="token class-name">WeatherServiceAsync</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function-definition function">fetchWeatherData</span><span class="token punctuation">(</span><span class="token keyword">for</span> city<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">CityWeather</span> <span class="token punctuation">{</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">createWeatherURL</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> city<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token class-name">URLError</span><span class="token punctuation">(</span><span class="token punctuation">.</span>badURL<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">let</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token omit keyword">_</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token keyword">await</span> <span class="token class-name">URLSession</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> url<span class="token punctuation">)</span>
        <span class="token keyword">let</span> weatherData <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">JSONDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">CityWeather</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> data<span class="token punctuation">)</span>
        <span class="token keyword">return</span> weatherData
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>This code defines a Swift class named <code>WeatherServiceAsync</code>, which is responsible for fetching weather data for a specified city asynchronously. Here's a breakdown of how it works:</p> <h3 id="code-breakdown-2"><a href="#code-breakdown-2" class="header-anchor">#</a> Code Breakdown</h3> <p><strong>Imports</strong></p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token class-name">Foundation</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>This line imports the Foundation framework, which provides essential data types, collections, and operating system services.</li></ul> <p><strong>Class Declaration</strong></p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">WeatherServiceAsync</span> <span class="token punctuation">{</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>This line declares a class named <code>WeatherServiceAsync</code>.</li></ul> <p><strong>Asynchronous Method</strong></p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">fetchWeatherData</span><span class="token punctuation">(</span><span class="token keyword">for</span> city<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">CityWeather</span> <span class="token punctuation">{</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>This method, <code>fetchWeatherData</code>, takes a single parameter, <code>city</code>, which is a <code>String</code>. It is marked as <code>async</code> because it performs asynchronous operations, and it can also throw errors (<code>throws</code>), indicating that it may encounter issues while executing (like network errors or JSON decoding errors).</li> <li>It returns a <code>CityWeather</code> object, which is presumably a model struct or class representing the weather data for a city.</li></ul> <p><strong>Creating the URL</strong></p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">guard</span> <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">createWeatherURL</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> city<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token class-name">URLError</span><span class="token punctuation">(</span><span class="token punctuation">.</span>badURL<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>This line attempts to create a URL for the weather data by calling the <code>createWeatherURL</code> method with the <code>city</code> parameter.</li> <li>If <code>createWeatherURL</code> returns <code>nil</code>, the method throws a <code>URLError</code> with a <code>.badURL</code> case, indicating that the URL is invalid.</li></ul> <p><strong>Fetching Data</strong></p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token omit keyword">_</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token keyword">await</span> <span class="token class-name">URLSession</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> url<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>This line uses <code>URLSession</code> to perform a network request. The <code>data(from:)</code> method is called asynchronously to fetch data from the specified URL.</li> <li>The result is a tuple where <code>data</code> contains the response data and the underscore <code>_</code> ignores the second value of the tuple (usually the URL response).</li></ul> <p><strong>Decoding the JSON Data</strong></p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> weatherData <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">JSONDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">CityWeather</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> data<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>This line uses <code>JSONDecoder</code> to decode the JSON data received from the network into an instance of <code>CityWeather</code>. If decoding fails, it throws an error.</li></ul> <p><strong>Returning the Decoded Data</strong></p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">return</span> weatherData
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>Finally, the method returns the decoded <code>CityWeather</code> object.</li></ul> <h3 id="summary-2"><a href="#summary-2" class="header-anchor">#</a> Summary</h3> <p>In summary, the <code>WeatherServiceAsync</code> class provides a method to asynchronously fetch weather data for a given city. It handles potential errors in URL creation, network fetching, and JSON decoding, making it a robust solution for retrieving weather information in a Swift application.</p></details> <h2 id="exercise-10"><a href="#exercise-10" class="header-anchor">#</a> Exercise 10</h2> <p>Using SwiftUI, create a view model <code>WeatherViewModel</code> that has a method <code>loadWeather(for:)</code> to fetch weather data asynchronously using <code>WeatherServiceAsync</code>. It should update the published properties <code>cityWeather</code> and <code>errorMessage</code> based on the success or failure of the data fetch. The view model should use <code>Task</code> to handle async operations.</p> <details class="custom-block details"><summary>Solution</summary> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span>

<span class="token attribute atrule">@MainActor</span>
<span class="token keyword">class</span> <span class="token class-name">WeatherViewModel</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">{</span>
    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> cityWeather<span class="token punctuation">:</span> <span class="token class-name">CityWeather</span><span class="token operator">?</span>
    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> errorMessage<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span>
    <span class="token keyword">private</span> <span class="token keyword">let</span> weatherService <span class="token operator">=</span> <span class="token class-name">WeatherServiceAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">func</span> <span class="token function-definition function">loadWeather</span><span class="token punctuation">(</span><span class="token keyword">for</span> city<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Task</span> <span class="token punctuation">{</span>
            <span class="token keyword">do</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> weather <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token keyword">await</span> weatherService<span class="token punctuation">.</span><span class="token function">fetchWeatherData</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> city<span class="token punctuation">)</span>
                cityWeather <span class="token operator">=</span> weather
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
                errorMessage <span class="token operator">=</span> error<span class="token punctuation">.</span>localizedDescription
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Here's a breakdown of the <code>WeatherViewModel</code>:</p> <h3 id="code-explanation"><a href="#code-explanation" class="header-anchor">#</a> Code Explanation</h3> <p><strong>Imports SwiftUI</strong></p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This line imports the SwiftUI framework, which provides the necessary infrastructure for building user interfaces in a declarative way.</p> <p><strong>Class Declaration</strong></p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token attribute atrule">@MainActor</span>
<span class="token keyword">class</span> <span class="token class-name">WeatherViewModel</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">{</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>The <code>@MainActor</code> attribute indicates that all the code within this class runs on the main thread, which is crucial for UI updates in SwiftUI.</li> <li><code>WeatherViewModel</code> conforms to <code>ObservableObject</code>, which means that instances of this class can be observed by SwiftUI views. When properties marked with <code>@Published</code> change, the views will be automatically notified to refresh.</li></ul> <p><strong>Properties</strong></p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> cityWeather<span class="token punctuation">:</span> <span class="token class-name">CityWeather</span><span class="token operator">?</span>
<span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> errorMessage<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span>
<span class="token keyword">private</span> <span class="token keyword">let</span> weatherService <span class="token operator">=</span> <span class="token class-name">WeatherServiceAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>@Published var cityWeather: CityWeather?</code>: This is an optional property that will hold the weather data for a specific city. It’s marked with <code>@Published</code>, so any changes to this property will trigger updates in the UI.</li> <li><code>@Published var errorMessage: String = &quot;&quot;</code>: This property holds an error message if something goes wrong while fetching weather data. It’s also marked with <code>@Published</code>.</li> <li><code>private let weatherService = WeatherServiceAsync()</code>: This is an instance of <code>WeatherServiceAsync</code>, which presumably contains methods for fetching weather data asynchronously.</li></ul> <p><strong>Method to Load Weather</strong>:</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">loadWeather</span><span class="token punctuation">(</span><span class="token keyword">for</span> city<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">Task</span> <span class="token punctuation">{</span>
       <span class="token keyword">do</span> <span class="token punctuation">{</span>
           <span class="token keyword">let</span> weather <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token keyword">await</span> weatherService<span class="token punctuation">.</span><span class="token function">fetchWeatherData</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> city<span class="token punctuation">)</span>
           cityWeather <span class="token operator">=</span> weather
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
           errorMessage <span class="token operator">=</span> error<span class="token punctuation">.</span>localizedDescription
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li><code>func loadWeather(for city: String)</code>: This method takes a city name as a parameter and is responsible for loading the weather data for that city.</li> <li><code>Task { ... }</code>: This creates an asynchronous task to run the code inside its closure.</li> <li><code>do { ... } catch { ... }</code>: This structure is used for error handling. The code inside the <code>do</code> block is attempted first, and if an error is thrown, the control moves to the <code>catch</code> block.</li> <li><code>let weather = try await weatherService.fetchWeatherData(for: city)</code>: This line calls the <code>fetchWeatherData(for:)</code> method on the <code>weatherService</code> instance, awaiting the result. If successful, the fetched weather data is assigned to <code>cityWeather</code>.</li> <li><code>errorMessage = error.localizedDescription</code>: If an error occurs during the fetch operation, the error's localized description is assigned to <code>errorMessage</code>, which can then be used to inform the user of what went wrong.</li></ul> <h3 id="summary-3"><a href="#summary-3" class="header-anchor">#</a> Summary</h3> <p>In summary, <code>WeatherViewModel</code> is a SwiftUI view model responsible for fetching weather data for a specified city. It uses async/await for asynchronous operations and publishes updates to its properties, allowing any observing SwiftUI views to react to changes in the weather data or error messages. This approach promotes clean separation of concerns between the data logic and the UI in a SwiftUI application.</p></details></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/2/2025, 9:45:14 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/w2025/modules/week10/lecture2.html" class="prev">
        REST APIs 🚀
      </a></span> <span class="next"><a href="/w2025/modules/week11/lecture1.html">
        MapKit 🚀
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/w2025/assets/js/app.89661042.js" defer></script><script src="/w2025/assets/js/2.19621ee8.js" defer></script><script src="/w2025/assets/js/1.884addea.js" defer></script><script src="/w2025/assets/js/37.d8fe8075.js" defer></script>
  </body>
</html>
