<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Storage 🚀 | MAD9137</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="iOS App Development">
    
    <link rel="preload" href="/w2025/assets/css/0.styles.b90e271b.css" as="style"><link rel="preload" href="/w2025/assets/js/app.89661042.js" as="script"><link rel="preload" href="/w2025/assets/js/2.19621ee8.js" as="script"><link rel="preload" href="/w2025/assets/js/1.884addea.js" as="script"><link rel="preload" href="/w2025/assets/js/56.1812c123.js" as="script"><link rel="prefetch" href="/w2025/assets/js/10.14d5c403.js"><link rel="prefetch" href="/w2025/assets/js/11.03916557.js"><link rel="prefetch" href="/w2025/assets/js/12.b43e8f2c.js"><link rel="prefetch" href="/w2025/assets/js/13.6649c7b8.js"><link rel="prefetch" href="/w2025/assets/js/14.88d905c8.js"><link rel="prefetch" href="/w2025/assets/js/15.7e17213b.js"><link rel="prefetch" href="/w2025/assets/js/16.e53c757f.js"><link rel="prefetch" href="/w2025/assets/js/17.3cc02802.js"><link rel="prefetch" href="/w2025/assets/js/18.81d0be88.js"><link rel="prefetch" href="/w2025/assets/js/19.ca440789.js"><link rel="prefetch" href="/w2025/assets/js/20.5a6b51cb.js"><link rel="prefetch" href="/w2025/assets/js/21.fdfc60c0.js"><link rel="prefetch" href="/w2025/assets/js/22.d45beffc.js"><link rel="prefetch" href="/w2025/assets/js/23.748b914a.js"><link rel="prefetch" href="/w2025/assets/js/24.562b255d.js"><link rel="prefetch" href="/w2025/assets/js/25.07dd87ce.js"><link rel="prefetch" href="/w2025/assets/js/26.a99defbe.js"><link rel="prefetch" href="/w2025/assets/js/27.57083705.js"><link rel="prefetch" href="/w2025/assets/js/28.e39dc93e.js"><link rel="prefetch" href="/w2025/assets/js/29.a5b2f49c.js"><link rel="prefetch" href="/w2025/assets/js/3.f5bb6a7e.js"><link rel="prefetch" href="/w2025/assets/js/30.de0a6d63.js"><link rel="prefetch" href="/w2025/assets/js/31.bfc16249.js"><link rel="prefetch" href="/w2025/assets/js/32.d9c060a0.js"><link rel="prefetch" href="/w2025/assets/js/33.a2d064ce.js"><link rel="prefetch" href="/w2025/assets/js/34.b8161021.js"><link rel="prefetch" href="/w2025/assets/js/35.a40d4351.js"><link rel="prefetch" href="/w2025/assets/js/36.9403338f.js"><link rel="prefetch" href="/w2025/assets/js/37.d8fe8075.js"><link rel="prefetch" href="/w2025/assets/js/38.9e90ebe0.js"><link rel="prefetch" href="/w2025/assets/js/39.25172786.js"><link rel="prefetch" href="/w2025/assets/js/4.86681f1d.js"><link rel="prefetch" href="/w2025/assets/js/40.6681711c.js"><link rel="prefetch" href="/w2025/assets/js/41.f4e3d0a0.js"><link rel="prefetch" href="/w2025/assets/js/42.8c656f3d.js"><link rel="prefetch" href="/w2025/assets/js/43.31dda87d.js"><link rel="prefetch" href="/w2025/assets/js/44.24c69334.js"><link rel="prefetch" href="/w2025/assets/js/45.5e16c653.js"><link rel="prefetch" href="/w2025/assets/js/46.044a1533.js"><link rel="prefetch" href="/w2025/assets/js/47.1830e7db.js"><link rel="prefetch" href="/w2025/assets/js/48.9be09712.js"><link rel="prefetch" href="/w2025/assets/js/49.4451aa8c.js"><link rel="prefetch" href="/w2025/assets/js/5.adc9a5d1.js"><link rel="prefetch" href="/w2025/assets/js/50.81e47b6b.js"><link rel="prefetch" href="/w2025/assets/js/51.3b191912.js"><link rel="prefetch" href="/w2025/assets/js/52.479b82bb.js"><link rel="prefetch" href="/w2025/assets/js/53.729d7b6c.js"><link rel="prefetch" href="/w2025/assets/js/54.4a8647ab.js"><link rel="prefetch" href="/w2025/assets/js/55.055c6480.js"><link rel="prefetch" href="/w2025/assets/js/57.b2aeb55f.js"><link rel="prefetch" href="/w2025/assets/js/58.9f74ca68.js"><link rel="prefetch" href="/w2025/assets/js/59.973fa6ff.js"><link rel="prefetch" href="/w2025/assets/js/6.6eb1a791.js"><link rel="prefetch" href="/w2025/assets/js/60.dbaf804d.js"><link rel="prefetch" href="/w2025/assets/js/61.bf2bcd99.js"><link rel="prefetch" href="/w2025/assets/js/62.c8975600.js"><link rel="prefetch" href="/w2025/assets/js/63.1dc95d7a.js"><link rel="prefetch" href="/w2025/assets/js/64.b1f5fc8e.js"><link rel="prefetch" href="/w2025/assets/js/65.37d03985.js"><link rel="prefetch" href="/w2025/assets/js/66.cf8375ea.js"><link rel="prefetch" href="/w2025/assets/js/67.f92bb3ff.js"><link rel="prefetch" href="/w2025/assets/js/68.779861c3.js"><link rel="prefetch" href="/w2025/assets/js/69.cc00bcbf.js"><link rel="prefetch" href="/w2025/assets/js/7.b2a63ac7.js"><link rel="prefetch" href="/w2025/assets/js/70.362eb054.js"><link rel="prefetch" href="/w2025/assets/js/71.aad5c756.js"><link rel="prefetch" href="/w2025/assets/js/72.1a4b2363.js"><link rel="prefetch" href="/w2025/assets/js/73.aa3beb5c.js"><link rel="prefetch" href="/w2025/assets/js/74.25ee9996.js"><link rel="prefetch" href="/w2025/assets/js/75.3bca0c1f.js"><link rel="prefetch" href="/w2025/assets/js/76.ed9eeaee.js"><link rel="prefetch" href="/w2025/assets/js/77.2d013309.js"><link rel="prefetch" href="/w2025/assets/js/78.aba051f0.js"><link rel="prefetch" href="/w2025/assets/js/79.bfa621d0.js"><link rel="prefetch" href="/w2025/assets/js/80.5ea75b6b.js"><link rel="prefetch" href="/w2025/assets/js/81.c963a39c.js"><link rel="prefetch" href="/w2025/assets/js/82.cb43b67f.js"><link rel="prefetch" href="/w2025/assets/js/83.d9e9c653.js"><link rel="prefetch" href="/w2025/assets/js/84.827a886f.js"><link rel="prefetch" href="/w2025/assets/js/85.2c52868b.js"><link rel="prefetch" href="/w2025/assets/js/86.ac7150af.js"><link rel="prefetch" href="/w2025/assets/js/87.b3adcd6f.js"><link rel="prefetch" href="/w2025/assets/js/vendors~docsearch.02634ae8.js">
    <link rel="stylesheet" href="/w2025/assets/css/0.styles.b90e271b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/w2025/" class="home-link router-link-active"><!----> <span class="site-name">MAD9137</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/w2025/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/w2025/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2025/modules/week1/lecture1.html" class="nav-link">
  Modules
</a></div><div class="nav-item"><a href="/w2025/assessment/" class="nav-link">
  Assessments
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/w2025/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/w2025/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2025/modules/week1/lecture1.html" class="nav-link">
  Modules
</a></div><div class="nav-item"><a href="/w2025/assessment/" class="nav-link">
  Assessments
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week1/" class="sidebar-heading clickable"><span>Week 1</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week2/" class="sidebar-heading clickable"><span>Week 2</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week3/" class="sidebar-heading clickable"><span>Week 3</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week4/" class="sidebar-heading clickable"><span>Week 4</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week5/" class="sidebar-heading clickable"><span>Week 5</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week6/" class="sidebar-heading clickable"><span>Week 6</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week7/" class="sidebar-heading clickable"><span>Week 7</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/w2025/modules/week8/" class="sidebar-link">Week 8</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week9/" class="sidebar-heading clickable"><span>Week 9</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week10/" class="sidebar-heading clickable"><span>Week 10</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week11/" class="sidebar-heading clickable"><span>Week 11</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week12/" class="sidebar-heading clickable"><span>Week 12</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week13/" class="sidebar-heading clickable"><span>Week 13</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/w2025/modules/week14/" class="sidebar-heading clickable router-link-active open"><span>Week 14</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/w2025/modules/week14/firebase-auth.html" class="sidebar-link">Authentication 🚀</a></li><li><a href="/w2025/modules/week14/firebase-firestore.html" class="sidebar-link">Firestore 🚀</a></li><li><a href="/w2025/modules/week14/firebase-storage.html" aria-current="page" class="active sidebar-link">Storage 🚀</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2025/modules/week14/firebase-storage.html#creating-the-storagemanager" class="sidebar-link">Creating the StorageManager</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2025/modules/week14/firebase-storage.html#step-1-storagemanager-code" class="sidebar-link">Step 1: StorageManager Code</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/week14/firebase-storage.html#explanation" class="sidebar-link">Explanation</a></li></ul></li><li class="sidebar-sub-header"><a href="/w2025/modules/week14/firebase-storage.html#building-the-photo-picker" class="sidebar-link">Building the Photo Picker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2025/modules/week14/firebase-storage.html#step-2-photopickerview-code" class="sidebar-link">Step 2: PhotoPickerView Code</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/week14/firebase-storage.html#explanation-2" class="sidebar-link">Explanation</a></li></ul></li><li class="sidebar-sub-header"><a href="/w2025/modules/week14/firebase-storage.html#uploading-and-displaying-images" class="sidebar-link">Uploading and Displaying Images</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2025/modules/week14/firebase-storage.html#step-3-contentview-code" class="sidebar-link">Step 3: ContentView Code</a></li><li class="sidebar-sub-header"><a href="/w2025/modules/week14/firebase-storage.html#ui-highlights" class="sidebar-link">UI Highlights</a></li></ul></li><li class="sidebar-sub-header"><a href="/w2025/modules/week14/firebase-storage.html#handling-permissions" class="sidebar-link">Handling Permissions</a></li></ul></li><li><a href="/w2025/modules/week14/firebase-analytics.html" class="sidebar-link">Analytics 🚀</a></li><li><a href="/w2025/modules/week14/firebase-remote-config.html" class="sidebar-link">Remote Config 🚀</a></li></ul></section></li><li><a href="/w2025/modules/week15/" class="sidebar-link">Week 15</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="storage-🚀"><a href="#storage-🚀" class="header-anchor">#</a> Storage 🚀</h1> <p>In this lecture, we’ll learn how to use <strong>Firebase Storage</strong> in a SwiftUI app. You’ll build a small app that lets users select photos from their library and upload them to Firebase Storage. The app will also display a list of photos the user has already uploaded.</p> <hr> <h2 id="creating-the-storagemanager"><a href="#creating-the-storagemanager" class="header-anchor">#</a> <strong>Creating the StorageManager</strong></h2> <p>The <code>StorageManager</code> is a central utility class that handles all Firebase Storage interactions, such as uploading images and fetching their URLs. By encapsulating these features, we keep the rest of our app clean and focused on UI logic.</p> <h3 id="step-1-storagemanager-code"><a href="#step-1-storagemanager-code" class="header-anchor">#</a> <strong>Step 1: StorageManager Code</strong></h3> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token class-name">Foundation</span>
<span class="token keyword">import</span> <span class="token class-name">FirebaseStorage</span>
<span class="token keyword">import</span> <span class="token class-name">UIKit</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">StorageManager</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> shared <span class="token operator">=</span> <span class="token class-name">StorageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">private</span> <span class="token keyword">let</span> storage <span class="token operator">=</span> <span class="token class-name">Storage</span><span class="token punctuation">.</span><span class="token function">storage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reference</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">private</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">func</span> <span class="token function-definition function">uploadImage</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> image<span class="token punctuation">:</span> <span class="token class-name">UIImage</span><span class="token punctuation">,</span> forUserID userID<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token constant">URL</span> <span class="token punctuation">{</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> imageData <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token function">jpegData</span><span class="token punctuation">(</span>compressionQuality<span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token class-name">NSError</span><span class="token punctuation">(</span>domain<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;InvalidImageData&quot;</span></span><span class="token punctuation">,</span> code<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">let</span> imageID <span class="token operator">=</span> <span class="token function">UUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>uuidString
        <span class="token keyword">let</span> imageRef <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;images/</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">userID</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">/</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">imageID</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">.jpg&quot;</span></span><span class="token punctuation">)</span>

        <span class="token omit keyword">_</span> <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token keyword">await</span> imageRef<span class="token punctuation">.</span><span class="token function">putDataAsync</span><span class="token punctuation">(</span>imageData<span class="token punctuation">,</span> metadata<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">try</span> <span class="token keyword">await</span> imageRef<span class="token punctuation">.</span><span class="token function">downloadURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">func</span> <span class="token function-definition function">fetchImageURLs</span><span class="token punctuation">(</span>forUserID userID<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token constant">URL</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> userImagesRef <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;images/</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">userID</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token keyword">await</span> userImagesRef<span class="token punctuation">.</span><span class="token function">listAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token keyword">try</span> <span class="token keyword">await</span> <span class="token function">withThrowingTaskGroup</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> group <span class="token keyword">in</span>
            <span class="token keyword">for</span> item <span class="token keyword">in</span> result<span class="token punctuation">.</span>items <span class="token punctuation">{</span>
                group<span class="token punctuation">.</span>addTask <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token keyword">try</span> <span class="token keyword">await</span> item<span class="token punctuation">.</span><span class="token function">downloadURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">try</span> <span class="token keyword">await</span> group<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>into<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token constant">URL</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token short-argument">$1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><hr> <h3 id="explanation"><a href="#explanation" class="header-anchor">#</a> <strong>Explanation</strong></h3> <ol><li><p><strong>Singleton Design Pattern:</strong><br>
Using <code>static let shared</code> ensures we only have one instance of <code>StorageManager</code> throughout the app.</p></li> <li><p><strong>Uploading an Image:</strong></p> <ul><li>Images are converted to <code>JPEG</code> format for efficient storage.</li> <li>Each image is stored under a unique path using the user ID and a UUID.</li></ul></li> <li><p><strong>Fetching URLs:</strong></p> <ul><li>Firebase Storage allows you to list all files in a directory.</li> <li>A <code>TaskGroup</code> is used to fetch URLs concurrently for better performance.</li></ul></li></ol> <hr> <h2 id="building-the-photo-picker"><a href="#building-the-photo-picker" class="header-anchor">#</a> <strong>Building the Photo Picker</strong></h2> <p>We’ll use the <code>PhotosPicker</code> from SwiftUI to allow users to select an image. After selection, the image will be uploaded to Firebase Storage.</p> <h3 id="step-2-photopickerview-code"><a href="#step-2-photopickerview-code" class="header-anchor">#</a> <strong>Step 2: PhotoPickerView Code</strong></h3> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span>
<span class="token keyword">import</span> <span class="token class-name">PhotosUI</span>

<span class="token keyword">struct</span> <span class="token class-name">PhotoPickerView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token attribute atrule">@Binding</span> <span class="token keyword">var</span> selectedImage<span class="token punctuation">:</span> <span class="token class-name">UIImage</span><span class="token operator">?</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> selectedPickerItem<span class="token punctuation">:</span> <span class="token class-name">PhotosPickerItem</span><span class="token operator">?</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
        <span class="token class-name">PhotosPicker</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Pick a Photo&quot;</span></span><span class="token punctuation">,</span> selection<span class="token punctuation">:</span> $selectedPickerItem<span class="token punctuation">,</span> matching<span class="token punctuation">:</span> <span class="token punctuation">.</span>images<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> selectedPickerItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Task</span> <span class="token punctuation">{</span>
                    <span class="token keyword">await</span> <span class="token function">loadImage</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> selectedPickerItem<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">loadImage</span><span class="token punctuation">(</span>from pickerItem<span class="token punctuation">:</span> <span class="token class-name">PhotosPickerItem</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> pickerItem <span class="token operator">=</span> pickerItem <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>

        <span class="token keyword">do</span> <span class="token punctuation">{</span>
            <span class="token comment">// Load the image data and convert it to a UIImage</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token keyword">await</span> pickerItem<span class="token punctuation">.</span><span class="token function">loadTransferable</span><span class="token punctuation">(</span>type<span class="token punctuation">:</span> <span class="token class-name">Data</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               <span class="token keyword">let</span> image <span class="token operator">=</span> <span class="token class-name">UIImage</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                selectedImage <span class="token operator">=</span> image
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Failed to load image: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error<span class="token punctuation">.</span>localizedDescription</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><hr> <h3 id="explanation-2"><a href="#explanation-2" class="header-anchor">#</a> <strong>Explanation</strong></h3> <ol><li><p><strong><code>PhotosPicker</code>:</strong><br>
A SwiftUI component for selecting photos. It’s modern, intuitive, and easy to integrate.</p></li> <li><p><strong><code>onChange</code>:</strong><br>
We listen for changes to the selected item and load the image when a new item is picked.</p></li> <li><p><strong>Image Loading:</strong></p> <ul><li>The <code>PhotosPickerItem</code> provides the raw image data.</li> <li>We convert the data into a <code>UIImage</code> to use in our app.</li></ul></li></ol> <hr> <h2 id="uploading-and-displaying-images"><a href="#uploading-and-displaying-images" class="header-anchor">#</a> <strong>Uploading and Displaying Images</strong></h2> <p>Now, we’ll create the main view, <code>ContentView</code>, which integrates the photo picker and uploads the image to Firebase Storage.</p> <h3 id="step-3-contentview-code"><a href="#step-3-contentview-code" class="header-anchor">#</a> <strong>Step 3: ContentView Code</strong></h3> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> selectedImage<span class="token punctuation">:</span> <span class="token class-name">UIImage</span><span class="token operator">?</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> uploadedImageURLs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token constant">URL</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isUploading <span class="token operator">=</span> <span class="token boolean">false</span>

    <span class="token keyword">let</span> userID <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;example_user&quot;</span></span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
        <span class="token class-name">VStack</span> <span class="token punctuation">{</span>
            <span class="token comment">// Photo Picker</span>
            <span class="token class-name">PhotoPickerView</span><span class="token punctuation">(</span>selectedImage<span class="token punctuation">:</span> $selectedImage<span class="token punctuation">)</span>

            <span class="token comment">// Show selected image</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> image <span class="token operator">=</span> selectedImage <span class="token punctuation">{</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span>uiImage<span class="token punctuation">:</span> image<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">)</span>

                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Upload Photo&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Task</span> <span class="token punctuation">{</span>
                        <span class="token keyword">await</span> <span class="token function">uploadPhoto</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token punctuation">.</span><span class="token function">disabled</span><span class="token punctuation">(</span>isUploading<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// List of uploaded images</span>
            <span class="token class-name">List</span><span class="token punctuation">(</span>uploadedImageURLs<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> url <span class="token keyword">in</span>
                <span class="token class-name">AsyncImage</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span> phase <span class="token keyword">in</span>
                    <span class="token keyword">switch</span> phase <span class="token punctuation">{</span>
                    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">let</span> image<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        image<span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">case</span> <span class="token punctuation">.</span>failure<span class="token punctuation">:</span>
                        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Failed to load image&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">default</span><span class="token punctuation">:</span>
                        <span class="token class-name">ProgressView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span>task <span class="token punctuation">{</span>
            <span class="token keyword">await</span> <span class="token function">fetchUploadedImages</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">uploadPhoto</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> image<span class="token punctuation">:</span> <span class="token class-name">UIImage</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
        isUploading <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">do</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token keyword">await</span> <span class="token class-name">StorageManager</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">uploadImage</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> forUserID<span class="token punctuation">:</span> userID<span class="token punctuation">)</span>
            uploadedImageURLs<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Upload failed: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error<span class="token punctuation">.</span>localizedDescription</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        isUploading <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">fetchUploadedImages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
        <span class="token keyword">do</span> <span class="token punctuation">{</span>
            uploadedImageURLs <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token keyword">await</span> <span class="token class-name">StorageManager</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">fetchImageURLs</span><span class="token punctuation">(</span>forUserID<span class="token punctuation">:</span> userID<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Failed to fetch images: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error<span class="token punctuation">.</span>localizedDescription</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><hr> <h3 id="ui-highlights"><a href="#ui-highlights" class="header-anchor">#</a> <strong>UI Highlights</strong></h3> <ol><li><p><strong><code>PhotoPickerView</code>:</strong><br>
Lets users pick an image to upload.</p></li> <li><p><strong><code>AsyncImage</code>:</strong><br>
Dynamically loads and displays uploaded images.</p></li> <li><p><strong>Buttons:</strong></p> <ul><li>Uploads the selected image.</li> <li>Fetches and displays the list of uploaded images.</li></ul></li></ol> <hr> <h2 id="handling-permissions"><a href="#handling-permissions" class="header-anchor">#</a> <strong>Handling Permissions</strong></h2> <p>Ensure the app has the necessary permissions by adding the following to <code>Info.plist</code>:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>key</span><span class="token punctuation">&gt;</span></span>NSPhotoLibraryUsageDescription<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>key</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>We need access to your photos for uploading.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/19/2024, 12:58:48 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/w2025/modules/week14/firebase-firestore.html" class="prev">
        Firestore 🚀
      </a></span> <span class="next"><a href="/w2025/modules/week14/firebase-analytics.html">
        Analytics 🚀
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/w2025/assets/js/app.89661042.js" defer></script><script src="/w2025/assets/js/2.19621ee8.js" defer></script><script src="/w2025/assets/js/1.884addea.js" defer></script><script src="/w2025/assets/js/56.1812c123.js" defer></script>
  </body>
</html>
